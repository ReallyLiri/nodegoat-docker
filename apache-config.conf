<VirtualHost *:80>
    ServerAdmin admin@localhost
    ServerName localhost
    ServerAlias *

    # Get the server name from the Host: header
    UseCanonicalName Off

    # Set document root
    DocumentRoot /var/1100CC/APP

    # 1100CC requires RewriteMap in server context
    RewriteEngine On

    # Remove line breaks from URLs
    RewriteRule ^(.*)(?:\r?\n|\r)(.*)?$ $1$2 [N]

    # 1100CC alias mapping - MUST be in server/vhost context
    RewriteMap alias "txt:/var/1100CC/APP/alias"

    <Directory /var/1100CC/APP>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Enable .htaccess
        <IfModule mod_rewrite.c>
            RewriteEngine On
        </IfModule>
    </Directory>

    # Cache directory permissions
    <Directory /var/1100CC/APP/CACHE>
        Options -Indexes
        Require all granted
    </Directory>

    # Storage directory permissions
    <Directory /var/1100CC/APP/STORAGE>
        Options -Indexes
        Require all granted
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>